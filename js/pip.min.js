let availableSpace=null;function makeRequest(e,t,n="core/api.php",i,o="POST"){let l=new XMLHttpRequest;l.open(o,n),l.onload=function(){4==this.readyState&&200==this.status&&t&&t(this.responseText?JSON.parse(this.responseText):void 0)},l.upload.onprogress=i;let s=new FormData;for(let t in e)s.append(t,e[t]);l.send(s)}function formatsize(e){return e<=1e6&&(e=(e/1e3).toFixed(2)+" KB"),(1e6==e||e<=1e9)&&(e=(e/1e6).toFixed(2)+" MB"),(1e9==e||e<=1e12)&&(e=(e/1e9).toFixed(2)+" GB"),e}function file_delete(e,t,n){let i={file_delete:t};n&&(i.sid=n),makeRequest(i,(function(e){e.fm_mod?get_file_list(n):get_file_list()}),"core/file_manager.php")}function gen_preview(e,t,n){return"jpeg"==e||"jpg"==e||"png"==e||"gif"==e?"<img class='col-auto mb-3' style='border: 2px solid #46B7AA;' src='"+location.protocol+"//"+location.hostname+encodeURI("/storage/"+t+"/"+n)+"'></img>":"mp4"==e||"webm"==e?"<video controls class='col-auto mb-3' style='border: 2px solid #46B7AA; width:100%;' src='"+location.protocol+"//"+location.hostname+encodeURI("/storage/"+t+"/"+n)+"'></video>":"zip"==e?"<i style='color: #46B7AA;' class='h1 bi bi-file-earmark-zip-fill'></i>":"txt"==e?"<i style='color: #46B7AA;' class='h1 bi bi-filetype-txt'></i>":"<i style='color: #46B7AA;' class='h1 bi bi-file-earmark-text-fill'></i>"}function get_file_list(sid,name,skip_render){let form={file_list:""};sid&&(form.sid=sid),makeRequest(form,(function(resp){document.getElementById(sid?"filemb":"filemanager").innerHTML="",resp.spaceleft&&(availableSpace=parseInt(resp.spaceleft),document.getElementById("fldrop").innerHTML="",document.getElementById("stinf").innerHTML="",document.getElementById("aviable").innerHTML="(Доступно: "+formatsize(resp.spaceleft)+")",document.getElementById("fldrop").innerHTML="Список файлов ("+resp.storagecnt+"/"+resp.storagemaxcnt+")",document.getElementById("stinf").innerHTML="Размер хранилища: "+formatsize(resp.storagelimit)),window._fileListCache={sid:sid,files:[],resp:resp};for(var i=0,row;row=resp[i];i++)if(window._fileListCache.files.push(row),!skip_render){let counter=eval(i+1),fid="file_"+counter;document.getElementById(sid?"filemb":"filemanager").innerHTML+="<div class='card mb-4 text-black hoverscale stuser' style='border-radius:20px; width:200px; height:auto; cursor: pointer;overflow: hidden;'><div class='card-body'><div class='row p-1 mb-1'><div class='col'>"+gen_preview(row.extension,resp.sid,row.name)+"<h6 class='title'>"+row.name+"</h6><h6 class='title' style='color:#46B7AA;'>Размер: "+row.size+"</h6></div></div></div><div class='btn-group'><button class='btn btn-outline-dark btn-sm border-start-0 border-bottom-0' title='Скопировать ссылку' onclick=\"navigator.clipboard.writeText(location.protocol+'//'+location.hostname+encodeURI('/storage/"+resp.sid+"/"+row.name+"'))\"><i class='bi bi-share'></i></button><a title='Загрузить файл' class='btn btn-outline-dark btn-sm border-bottom-0' href='/storage/"+resp.sid+"/"+row.name+"' download><i class='bi bi-cloud-arrow-down'></i></a><button class='btn btn-outline-dark btn-sm border-end-0 border-bottom-0' title='Удалить файл' onclick=\"file_delete('"+fid+"','"+row.name+(sid?"','"+sid:"")+"')\"><i class='bi bi-trash'></i></button></div>"}if(resp.warn&&(document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Внимание!</strong> "+resp.warn+".<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>"),sid&&name){var myModal=new bootstrap.Modal(document.getElementById("filemanager_modal"));myModal.toggle(),document.getElementById("fm_lbl").innerHTML="Moderate "+name+"'s Files"}}),"core/file_manager.php")}function render_file_list_from_cache(){if(!window._fileListCache||!window._fileListCache.files)return;let sid=window._fileListCache.sid,resp=window._fileListCache.resp,files=window._fileListCache.files,container=document.getElementById(sid?"filemb":"filemanager");container.innerHTML="";for(var i=0,row;row=files[i];i++){let counter=eval(i+1),fid="file_"+counter;container.innerHTML+="<div class='card mb-4 text-black hoverscale stuser' style='border-radius:20px; width:200px; height:auto; cursor: pointer;overflow: hidden;'><div class='card-body'><div class='row p-1 mb-1'><div class='col'>"+gen_preview(row.extension,resp.sid,row.name)+"<h6 class='title'>"+row.name+"</h6><h6 class='title' style='color:#46B7AA;'>Размер: "+row.size+"</h6></div></div></div><div class='btn-group'><button class='btn btn-outline-dark btn-sm border-start-0 border-bottom-0' title='Скопировать ссылку' onclick=\"navigator.clipboard.writeText(location.protocol+'//'+location.hostname+encodeURI('/storage/"+resp.sid+"/"+row.name+"'))\"><i class='bi bi-share'></i></button><a title='Загрузить файл' class='btn btn-outline-dark btn-sm border-bottom-0' href='/storage/"+resp.sid+"/"+row.name+"' download><i class='bi bi-cloud-arrow-down'></i></a><button class='btn btn-outline-dark btn-sm border-end-0 border-bottom-0' title='Удалить файл' onclick=\"file_delete('"+fid+"','"+row.name+(sid?"','"+sid:"")+"')\"><i class='bi bi-trash'></i></button></div>"}}document.getElementById("fileform").addEventListener("submit",(e=>{e.preventDefault();let t=document.getElementById("file").files[0];t&&(null!==availableSpace&&t.size>availableSpace?document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Ошибка!</strong> Файл слишком большой.<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>":makeRequest({file_submit:"",file:t},(function(t){t?t.error?document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Ошибка!</strong> "+e.error+"<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>":(document.getElementById("alertplace").innerHTML="",get_file_list()):document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Ошибка!</strong> Файл слишком большой.<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>",document.getElementById("progress").style.width="0%"}),"core/file_manager.php",(function(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);console.log("Загрузка: "+t+"%..."),document.getElementById("progress").style.width=t+"%"}})))}));let write_selected=null;if(null!=document.getElementById("write_modal")){function toggleWritedrop(e){var t=document.getElementById("write_modal"),n=new bootstrap.Modal(t);write_selected=e,n.toggle()}function note_edit(e){makeRequest({get_tinydata:e},(function(t){tinymce.activeEditor.modaledit=!0,tinymce.activeEditor.editingid=e,document.getElementById("iittl").classList.remove("d-none"),document.getElementById("iiimg").classList.remove("d-none"),document.getElementById("nremove").classList.remove("d-none"),document.getElementById("iinpttl").value=t.title,document.getElementById("iinpimg").value=t.headimg,document.getElementById("publish").innerHTML="Сохранить",document.getElementById("nremove").onclick=function(){makeRequest({nrm:e},(function(){get_notes()}))},new bootstrap.Modal(document.getElementById("write_modal")).toggle(),tinymce.activeEditor.execCommand("mceNewDocument"),tinymce.activeEditor.execCommand("mceInsertContent",!1,decodeURIComponent(escape(atob(t.content))))}))}function get_notes(e){makeRequest({get_notes:e??1},(function(e){let t=document.getElementById("notes_list");t.innerHTML="";for(var n,i=0;n=e.data[i];i++)t.innerHTML+="<div class='card mb-2 text-black hoverscale' style='height:fit-content;cursor:pointer;overflow:hidden;'><div class='card-body p-0'><div class='row'><img class='col-3' style='height:60px; object-fit:cover;' src='"+n.headimg+"'></img><h6 class='col title my-auto'><a href='/"+n.type+".php?id="+n.id+"' style='color:black;width:fit-content;height:fit-content;'>"+n.title+"</a></h6><h6 class='col title my-auto' style='color:#46B7AA;'>Тип: "+n.type+"</h6><button title='Редактировать запись' class='m-2 col-1 btn btn-sm btn-outline-dark' onclick=\"note_edit('"+n.id+"')\"><i class='bi bi-pencil-fill'></i></button></div></div></div>";if(e.pages>1){let t=document.getElementById("notes_pag");t.classList.remove("d-none"),t.innerHTML="",t.innerHTML+=(e.page>4?"<li class='page-item'><a class='page-link text-black shadow-none' onclick=\"get_notes()\"><span aria-hidden='true'>&laquo;</span></a></li>":"")+"<li class='page-item "+(1==e.page?"disabled":"")+"'><a class='page-link text-black shadow-none' onclick=\"get_notes('"+e.prev+"')\"><span aria-hidden='true'>Prev</span></a></li>";for(let n=1;n<=e.pages;n++)t.innerHTML+="<li class='page-item'><a class='page-link shadow-none text-black "+(e.page==n?"active":"")+"' onclick=\"get_notes('"+n+"')\">"+n+"</a></li>";t.innerHTML+="<li class='page-item "+(e.page==e.pages?"disabled":"")+"'><a class='page-link text-black shadow-none' onclick=\"get_notes('"+e.next+"')\"><span aria-hidden='true'>Next</span></a></li>",e.page<e.pages-2&&(t.innerHTML+="<li class='page-item'><a class='page-link text-black shadow-none' onclick=\"get_notes('"+e.pages+"')\"><span aria-hidden='true'>&raquo;</span></a></li>")}}))}document.getElementById("write_modal").addEventListener("show.bs.modal",(e=>{tinymce.activeEditor.modaledit||(write_selected?document.getElementById("modallbl").innerHTML="ultr4 "+write_selected.id+" wr1t3r 3000":e.preventDefault(),document.getElementById("iinpttl").value="",document.getElementById("iinpimg").value="",document.getElementById("nremove").classList.add("d-none"),document.getElementById("publish").innerHTML="Опубликовать",tinymce.activeEditor.execCommand("mceNewDocument"))})),document.getElementById("write_modal").addEventListener("hide.bs.modal",(e=>{tinymce.activeEditor.modaledit=!1,tinymce.activeEditor.isNotDirty=1})),document.getElementById("publish").addEventListener("click",(()=>{let e={};tinymce.activeEditor.modaledit?e.write_update=tinymce.activeEditor.editingid:e.write_save=write_selected.id,e.headimg=document.getElementById("iinpimg").value,e.title=document.getElementById("iinpttl").value,e.content=tinymce.get("tiny").getContent(),makeRequest(e,(function(e){document.getElementById("cancel").click(),e.success&&(get_notes(),console.log(e.success))}))})),document.addEventListener("focusin",(function(e){null!==e.target.closest(".tox-tinymce-aux, .moxman-window, .tam-assetmanager-root")&&e.stopImmediatePropagation()}))}let dropInput=document.getElementById("dropInput");if(null!=dropInput){function toggledrop(e){document.getElementById("optionDrop").innerHTML=e.innerHTML,selectedDrop=e,makeRequest({settings_infoget:e.id},(function(){dropInput.classList.remove("is-invalid"),dropInput.value=this.responseText.trim()}))}function toggleswitch(e){makeRequest({settings_insert:e.id,value:e.checked})}document.getElementById("saveDrop").addEventListener("click",(()=>{"undefined"==typeof selectedDrop?(dropInput.value="Select option first!",dropInput.classList.add("is-invalid")):makeRequest({settings_insert:selectedDrop.id,value:dropInput.value},(function(){"project_name"==selectedDrop.id&&(document.getElementById("project_name").innerHTML=dropInput.value)}))}));let e=document.getElementById("BGColorInput"),t=document.getElementById("BGColorInput2"),n=document.getElementById("BGColorInput3"),i=document.getElementById("BGColorInput4");document.addEventListener("input",(function(o){if("color"==o.target.type&&(document.body.style.backgroundImage="linear-gradient(-45deg, "+e.value+", "+t.value+", "+n.value+", "+i.value+")"),"file"==o.target.id)if(void 0!==file.files[0]){let e=formatsize(file.files[0].size);document.getElementById("uploadinf").classList.remove("d-none"),document.getElementById("filesize").innerHTML=e}else document.getElementById("uploadinf").classList.add("d-none")})),document.getElementById("savebg").addEventListener("click",(()=>{makeRequest({settings_insert:"bg_color",value:e.value+", "+t.value+", "+n.value+", "+i.value}),document.body.style.backgroundImage="linear-gradient(-45deg, "+e.value+", "+t.value+", "+n.value+", "+i.value+")"}))}if(null!=document.getElementById("srv_form")){function server_rm(e){makeRequest({svrm:e},(function(){get_servers()}))}function get_servers(){makeRequest({get_servers:get_servers},(function(resp){document.getElementById("servertable").innerHTML="",null!=document.getElementById("rcon_servs")&&(document.getElementById("rcon_servs").innerHTML="");for(var i=0,row;row=resp[i];i++){let counter=eval(i+1);document.getElementById("servertable").innerHTML+="<tr><th scope='row'>"+counter+"</  th><td>"+row.sv_name+"</td><td>"+row.sv_ip+"</td><td>"+row.sv_port+"</td><td><button class='btn btn-outline-dark btn-sm' title='Удалить сервер' onclick=\"server_rm('"+row.sv_name+"')\"><i class='bi bi-trash'></i></button></td></td></tr>",null!=document.getElementById("rcon_servs")&&(document.getElementById("rcon_servs").innerHTML+="<option value="+row.id+">"+row.sv_name+"</option>")}}))}document.getElementById("srv_form").addEventListener("submit",(e=>{e.preventDefault();let t={svsave:""},n=document.getElementById("srv_form").elements;for(let e=0;e<n.length;e++){let i=n[e];i.name&&(t[i.name]=i.value)}makeRequest(t,(function(){get_servers()}))}))}function nicedate(e){return(e=new Date(e)).toString().replace(/^[^\s]+\s([^\s]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s.*$/gi,"$3-"+(e.getMonth()+1)+"-$2 $4").slice(0,-3)}null!=document.getElementById("rcon_submit")&&document.getElementById("rcon_submit").addEventListener("click",(e=>{document.getElementById("typer").classList.add("d-none");let t=document.getElementById("rcon_string").value;makeRequest({rcon_submit:document.getElementById("rcon_servs").value,command:t},(function(e){document.getElementById("typer").classList.remove("d-none"),document.getElementById("rcon_response_place").innerHTML=">"+e.success}),"core/rcon.php")}));