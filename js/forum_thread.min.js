document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("editor");e&&(window.quill=new Quill(e,{theme:"snow",modules:{syntax:!0,toolbar:{container:[[{header:[1,2,3,!1]}],["blockquote","link"],["bold","italic","underline","strike"],["image","video","code-block"],[{list:"ordered"},{list:"bullet"},{font:[]}],[{align:[]},{color:[]}]],handlers:{image:function(){const e=this.quill.getSelection(),t=prompt("Введите ссылку на картинку.");t&&""!=t&&this.quill.insertEmbed(e?e.index:0,"image",t,Quill.sources.USER)}}}}})),document.querySelectorAll(".post-content").forEach((function(e){const t=JSON.parse(e.dataset.delta);new Quill(e,{readOnly:!0,theme:"snow",modules:{toolbar:!1,syntax:!0}}).setContents(t)}));const t=document.getElementById("publish");t&&t.addEventListener("click",(()=>{const e=JSON.stringify(window.quill.getContents()),t=new URLSearchParams(window.location.search).get("thread");fetch("core/api.php",{method:"POST",body:new URLSearchParams({forum:"new_post",thread_id:t,content:e})}).then((e=>e.json())).then((e=>{e.success?location.reload():alert(e.error||"Ошибка при публикации")})).catch((e=>{alert("Не удалось отправить пост")}))})),document.querySelectorAll(".thread-btn").forEach((function(e){e.addEventListener("click",(function(){const e=this.dataset.id,t=this.dataset.action;e&&t&&("delete_post"!==t||confirm("Удалить пост?"))&&("delete_thread"!==t||confirm("Удалить весь тред?"))&&fetch("core/api.php",{method:"POST",body:new URLSearchParams({forum_admin:t,id:e})}).then((e=>e.json())).then((o=>{if(o.success)if("delete_post"===t){const t=document.querySelector(`#post-${e}`);t&&t.remove()}else"delete_thread"===t?window.location.href="/forum.php":("pin_thread"===t||"lock_thread"===t)&&window.location.reload();else alert("Ошибка: "+(o.error||"Неизвестная ошибка"))})).catch((e=>{alert("Ошибка запроса")}))}))})),document.querySelectorAll(".reactions .reaction").forEach((e=>{e.addEventListener("click",(function(){const e=this.dataset.pid,t=this.dataset.type;fetch("core/api.php",{method:"POST",body:new URLSearchParams({forum:"reaction",post_id:e,type:t})}).then((e=>e.json())).then((e=>{if(e.success){const t=this.querySelector(".count"),o=e.count||0;e.added?this.classList.add("reacted"):e.removed&&this.classList.remove("reacted"),o>0?(t.style.display="inline",t.textContent=o):t.style.display="none"}else alert(e.error||"Ошибка реакции")})).catch((()=>alert("Ошибка запроса реакции")))}))}))}));